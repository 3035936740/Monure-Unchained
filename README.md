# Monure Unchained
***Break the chains of 440Hz. Rediscover the resonance.***

**Monure Unchained** 是一项实验性的音乐解析渲染方案
不仅仅是一个转换工具,也是一场关于"频率自由"的宣言
通过解开标准音高的束缚(*Unchained*),允许创作者深入物理声学的底层,重塑和声的骨架

---

### 音色库支持

本工具默认配置使用 **`Steinway B Prelube.sf2`** 音色库
* 该音色库采样自斯坦威钢琴,具有极佳的动态响应和共鸣
* 由于其高保真采样,在测试 `TUNING: JUST`(纯律)时，能显著听出谐波对齐后的纯净感,非常适合学术和实验音乐创作
* 请确保根目录存有该文件,或修改 `SF2_PATH` 常量

---

### 设计理念 / Philosophy
在流水线工业标准的 440Hz 之外,存在着未被发掘的振动空间,**`Monure Unchained`** 通过动态调律矩阵,赋予每一枚音符精确到音分(Cents)的自由度

* **极简记谱**: 支持 `C5`, `D#5` 等音符,使用 `_` 组合和弦(如 `C4_E4_G4`)
* **多维度控制**: 行内直接定义 `([midi位置]) [音符] [时长] [音量比例]`
* **物理级调律**: 
    * **BASE_PITCH**: 自由设定 A4 基准(如 432Hz 疗愈频率或 467Hz 古乐频率)
    * **TUNING**: 支持`12TET`(平均律)与`JUST`(纯律),或更多奇怪的率制(例如19TET)
    * **BPM**: 设置默认的`BPM`
    * **VOL**: 设置默认的`音量`
    * **DIV**: 设置默认的`note分割长度`
    * **DEF_LEN**: 设置默认`每小节长度`
* **自动流程**：基于 UUID 生成临时文件,渲染完成后自动清理,支持并发运行

---

### 语法解构 / DSL Syntax

#### 1.流式旋律 / Streamlined Melody
无需坐标,音符根据前序长度自动推行
```
# [音高] ([长度]) <-这个完全是可选的跟在音高后面
D5 A5 B5 4 A5 4 G5 A5 G5 F5 D5 16
D5 A5 B5 4 A5 4 G5 A5 C6 D6 B5 16

Rest # 使用关键字标记一段默认长度的空白
R 64 # 显式定义 64 长度的物理静止

C D E F G A B # 缺省状态下自动映射至全局默认八度(DEF_OCTAVE)
C5 C6 C7 # 显式跨八度标记
D D D D7 # 连续输入会自动保持在当前八度区间,直到遇到明确的强制跳转
```

#### 2.参数解析/ Parameters Breakdown
* `[1:Ether_Piano]` 定义了第一条音轨,并赋予其 Ether_Piano 的语义标签,这在渲染时会自动映射到你指定的 .sf2 音色库中的相应乐器(需自己修改代码实现)
* `BASE_PITCH: 432.0` 打破了 1939 年以来 A4=440Hz 的国际标准,432Hz 被认为更符合自然谐波规律,Monure 会重新计算所有音轨的数学中心,让声音听起来更温润、少了一份工业的紧绷感
* `TUNING: JUST` **(纯律)** 这是最关键的开关,在标准钢琴(12-TET)中,为了方便转调,三度音程被微调得"不那么准"
当开启 JUST 后,三和弦的频率比会回归完美的整数比(如 4:5:6)。这意味着音符之间的"拍频(Beating)"消失了,和弦听起来不再闪烁跳动,而是像一块**完整的、静止的水晶**
##### 动作序列解构 / Sequence Breakdown  
| 位置 (Tick) | 音符行为 | 物理表现 | 听感意图 |
|  ----  | ---- | ---- | ---- |
| **0** | A4 | 触发 432Hz 基准音 | 建立调性中心,清澈的开场 |
| **64** | E5 | 触发五度纯律音 | 建立空灵的支点,纯律下的五度音程极其稳定 |
| **128** | A4_C5_E5 | **和弦并发** | 系统自动计算 A-C-E 的频率偏移,C# 会比标准钢琴略低,从而与 A 和 E 达成物理级共鸣 |
```
# 全局时序与物理参数
BPM: 96
BASE_PITCH: 432.0
TUNING: JUST # 默认是12TET

[1:Ether_Piano]
# 位置 | 音高 | 长度 | 强度
0      A4     64     80
64     E5     64     85
128    A4_C5_E5      256    95  # 纯律加持下的三和弦,将会如水晶般剔透
```

#### 3.律制映射逻辑 (The nKm System)
这是本系统的核心  
通过 `TUNING` 定义八度内的切分数,使用 `nKm` 格式进行定位  
* **n**: 八度层级 (Octave)
* **m**: 该八度内的第 m 个等程台阶 (Step)

```
TUNING: 19K12  # 将八度等分为19份/当然你也可以设置TUNING: 19TET
[1:Lead]
4K1  32  90    # 第4八度的第1阶 (基准点)
4K10 32  85    # 第4八度的第10阶 (在19律中，这是极其纯净的五度)
5K1  64  80    # 跨越八度，回归基准
```

#### 4.时间锚点与光标流 (Temporal Anchors)
Monure 支持"绝对坐标"与"相对流"混合书写
```
[1:Ambient]
0    4K1  256  60   # 绝对位置：在 0 Tick 处放置长音
128  4K8  128  70   # 在长音进行到一半时，切入第二个音
+64  4K10 64   80   # 相对偏移：在上一音符起始点往后 64 Tick 处触发
```

#### 5.终极语法范例 / The Ultimate Manifesto
##### 1. 混合记谱与多轨协同
展示了流式输入与绝对坐标输入的共存
```
BPM: 100

[1:Piano]
# 第一段: 流式旋律 数字 4 和 16 动态改变了步进长度
D5 A5 B5 4 A5 4 G5 A5 G5 F5 D5 16
D5 A5 B5 4 A5 4 G5 A5 C6 D6 B5 16

[1:Chord]
# 第二轨: 和弦 D5, F5, A5, C6 同时触发, 持续 32 Tick
D5_F5_A5_C6 32
```
##### 2. 动态分段与参数重写(Pattern System)
通过 `[Pattern]` 块,你可以在乐曲中途无缝切换 BPM 时序分辨率(DIV)和音量基准
```
BPM: 120
DIV: 196
VOL: 80

[Pattern] # 序章: 高精度时序
DIV: 96         # 时序分辨率从196修改到96
BPM: 128        # BPM从120变化到128
[1:Piano]
0 C4 32         # 绝对坐标触发
3 G4 32         # 极小间距（仅3 Tick），展现 DIV: 196 的精细度
E4 16           # 自动推行
48 G#4_C5 16    # 强制跳转至第 48 Tick
F4 32
R               # 默认长度休止
C5 128          # 结尾长音

[2:Piano]
0 C4_E4_G4 64   # 与 Track 1 同步进行的背景和弦
```

##### 3. 元数据注入与音色扩展 (Meta Blocks)
使用 `< >` 为特定音轨注入非标准参数,这为外接合成器引擎(如自定义采样器)提供了无限可能
```
[Pattern] # 间奏：音色定义
DIV: 96
BPM: 128

[1:Piano]
0 C4 32
3 G4 32

[2:String]
<
  Source: string_like.wav  # 指定外部采样文件
  Pitch: C5                # 采样基准音高
  Test: 666                # 自定义参数映射
>
0 C4_E4_G4 64
```

##### 4. 极限性能与极简回归
在 Pattern 的末尾,展示了最精简的参数控制
```
[Pattern]
[1:Piano]
BPM: 150
# [位置] [音名] [长度] [力度倍率]
0 C 64 80   # 150 BPM 下的强力收尾, 力度为全局 VOL 的 80%
```

#### 调律矩阵 / Tuning Matrix
Monure Unchained 在渲染时会动态计算针对 **12TET** 的偏移向量, 并向引擎注入实时修正脚本:
| 律制 | 计算逻辑 | 核心听感 |
|  ----  | ---- | ---- |
| **12TET** | fn​=f0 * 2^[(n−69)/12] | 工业标准,无障碍转调 |
| **JUST** | Harmonic Ratios | 极度纯净,无拍频干扰 |

# 极速开始 / Quickstart
** 配置环境 **
确保你的系统中已安装 **FluidSynth** 与 **FFmpeg**

调用逻辑
```python
from monure_unchained import MonureParser, render_audio

# 解析灵魂，重塑振动
parser = MonureParser()
parser.parse("example/script1.mnr")

# 解放频率
render_audio("output.mid", "viva_piano.sf2", "unfettered_sound.wav", 
             base_pitch=432.0, tuning="JUST")
```

### 愿景 / Vision
> "当音符不再被迫均分,旋律才真正获得了自由"